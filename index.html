<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kelimeli Mahjong - ZamanlÄ±, PuanlÄ±, Ä°sim & Kelime YÃ¶neticili</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:12px; }
    h1 { margin:0 0 12px; }
    .layout { max-width: 1200px; margin: 0 auto; display:grid; grid-template-columns: 320px 1fr; gap:12px; }
    @media (max-width: 900px){ .layout{ grid-template-columns: 1fr; } }

    .panel { background:#020617; border:1px solid #1f2933; border-radius:16px; padding:10px; }
    .panel h3{ margin:4px 0 8px; }
    .best-table{ width:100%; border-collapse:separate; border-spacing:0 6px; font-size:12px; }
    .best-table th{ text-align:left; color:#94a3b8; font-weight:600; padding:0 6px 4px; }
    .best-row{ background:#0b1220; border:1px solid #1f2933; border-radius:12px; }
    .best-row td{ padding:6px 8px; }
    .best-row.first{ outline:2px solid #22c55e; box-shadow:0 0 0 2px rgba(34,197,94,.2) inset; }

    .toolbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
    select, button, input { background:#111827; color:#e5e7eb; border:1px solid #334155; border-radius:10px; padding:10px 12px; font-size:14px; }
    button { cursor:pointer; }
    button.primary { background:#2563eb; border-color:#2563eb; }
    button.warn { background:#7c2d12; border-color:#7c2d12; }
    button.ghost { background:#020617; }
    button:disabled { opacity:0.6; cursor:not-allowed; }
    .stats { display:flex; gap:12px; flex-wrap:wrap; }

    /* Mobilde Ã¼stte sabit kontrol barÄ± */
    .topbar{ position:sticky; top:0; z-index:20; background:#020617; border:1px solid #1f2933; border-radius:16px; padding:8px; margin-bottom:10px; }

    .board { display:grid; gap:8px; }
    .tile { background:#020617; border:1px solid #1f2933; border-radius:14px; padding:12px; min-height:64px; display:flex; align-items:center; justify-content:center; text-align:center; font-weight:700; font-size:18px; user-select:none; transition: transform .1s ease, background .2s ease, border .2s ease; }
    .tile:hover { transform: translateY(-1px); }
    .tile.hidden { background:#020617; color:transparent; }
    .tile.revealed { background:#0b1220; border-color:#3b82f6; }
    .tile.matched { background:#052e16; border-color:#22c55e; color:#86efac; }
    .footer { margin-top:12px; color:#94a3b8; }
    .success { color:#22c55e; }
    .danger { color:#f87171; }
    .grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }

    .namebar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    .badge{ background:#0b1220; border:1px solid #1f2933; border-radius:999px; padding:6px 10px; font-size:12px; }

    /* Modal */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,.7); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal{ background:#020617; border:1px solid #1f2933; border-radius:16px; padding:16px; width:min(520px, 92vw); }
    .modal h3{ margin:0 0 8px; }
    .modal .row{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .modal .row > *{ flex:1; }
    .modal .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }

    /* Kelime listesi */
    .word-list{ max-height:220px; overflow:auto; border:1px solid #1f2933; border-radius:12px; padding:8px; }
    .word-item{ display:flex; gap:8px; align-items:center; justify-content:space-between; background:#0b1220; border:1px solid #1f2933; border-radius:10px; padding:6px 8px; margin-bottom:6px; font-size:13px; }
    .word-item small{ color:#94a3b8; }

    @media (max-width: 600px){
      h1{ font-size:20px; }
      .tile{ font-size:16px; min-height:56px; }
      .grid{ grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sol: En Ä°yiler -->
    <aside class="panel">
      <h3>ğŸ† En Ä°yiler</h3>
      <p style="color:#94a3b8; font-size:13px; margin:0 0 8px;">Ä°sim â€¢ Dil â€¢ Seviye â€¢ SÃ¼re â€¢ Puan</p>
      <table class="best-table">
        <thead>
          <tr>
            <th>#</th><th>Ä°sim</th><th>Dil</th><th>Seviye</th><th>SÃ¼re</th><th>Puan</th>
          </tr>
        </thead>
        <tbody id="bestBody"></tbody>
      </table>
    </aside>

    <!-- SaÄŸ: Oyun -->
    <main class="app">
      <div class="topbar">
        <h1>ğŸ€„ Kelimeli Mahjong â€” ZamanlÄ± & PuanlÄ±</h1>
        <div class="namebar">
          <span class="badge">Oyuncu:</span>
          <strong id="playerNameLabel">â€”</strong>
          <button id="changeNameBtn" class="ghost">Ä°smi DeÄŸiÅŸtir</button>
          <button id="manageWordsBtn" class="ghost">Kelimeleri YÃ¶net</button>
        </div>
        <p>Seviyeler: <b>8</b> / <b>12</b> / <b>16</b> / <b>20</b> / <b>24</b> Ã§ift. Her oyun kelimeler <b>havuzdan rastgele</b> seÃ§ilir. DoÄŸru = +100, YanlÄ±ÅŸ = -25.</p>

        <div class="toolbar">
        <select id="langSel">
          <option value="en">Ä°ngilizce</option>
          <option value="ko">Korece</option>
        </select>
        <select id="pairsSel">
          <option value="8">8 Ã‡ift</option>
          <option value="12">12 Ã‡ift</option>
          <option value="16">16 Ã‡ift</option>
          <option value="20">20 Ã‡ift</option>
          <option value="24">24 Ã‡ift</option>
        </select>
        <button id="startBtn" class="primary">BaÅŸlat</button>
        <button id="hintBtn" class="ghost">Hint (-20p)</button>
        <span class="badge">Skor: <b id="score">0</b></span>
        <span class="badge">SÃ¼re: <b id="time">120</b></span>
        <span class="badge">Hamle: <b id="moves">0</b></span>
        <span class="badge">Hesap: <b id="accountScore">0</b></span>
      </div>
            <div>â­ <strong id="score">0</strong></div>
            <div>ğŸ¯ <strong id="matches">0</strong></div>
            <div>ğŸ‘£ <strong id="moves">0</strong></div>
          </div>
        </div>
      </div>

      <div id="board" class="board grid"></div>
      <div class="footer" id="status"></div>
    </main>
  </div>

  <!-- Ä°sim Modal -->
  <div id="nameModal" class="modal-backdrop">
    <div class="modal">
      <h3>Oyuncu AdÄ±</h3>
      <p style="color:#94a3b8; font-size:13px;">Skor tablosunda gÃ¶rÃ¼necek ismini yaz.</p>
      <div class="row">
        <input id="nameInput" placeholder="Ä°smin..." />
      </div>
      <div class="actions">
        <button id="nameCancel" class="ghost">VazgeÃ§</button>
        <button id="nameSave" class="primary">Kaydet</button>
      </div>
    </div>
  </div>

  <!-- Kelime YÃ¶netimi Modal -->
  <div id="wordsModal" class="modal-backdrop">
    <div class="modal">
      <h3>Kelime Havuzu</h3>
      <p style="color:#94a3b8; font-size:13px;">Kendi kelimelerini ekle/sil. Oyun bu havuzdan rastgele seÃ§ecek.</p>
      <div class="row">
        <select id="wordLangSelect">
          <option value="en">Ä°ngilizce</option>
          <option value="kr">Korece</option>
        </select>
      </div>
      <div class="row">
        <input id="wordA" placeholder="YabancÄ± kelime (Ã¶rn: apple / ì‚¬ê³¼)" />
        <input id="wordB" placeholder="TÃ¼rkÃ§e karÅŸÄ±lÄ±ÄŸÄ± (Ã¶rn: elma)" />
      </div>
      <div class="row">
        <button id="addWordBtn" class="primary">Ekle</button>
        <button id="clearCustomBtn" class="warn">Ã–zel Kelimeleri Temizle</button>
      </div>
      <div class="word-list" id="wordList"></div>
      <div class="actions">
        <button id="wordsClose" class="ghost">Kapat</button>
      </div>
    </div>
  </div>

  <script>
  // ====== Helpers ======
  function $(id){ return document.getElementById(id); }

  // ====== State ======
  let playerName = localStorage.getItem('playerName') || '';
  let totalAccountScore = Number(localStorage.getItem('accountScore')||0);
  let currentLang = 'en';
  let pairs = 8;
  let timeLeft = 120;
  let timer = null;
  let first = null;
  let lock = false;
  let moves = 0;
  let score = 0;
  let streak = 0; // hatasÄ±z seri
  let mistakeStreak = 0; // arka arkaya hata
  let hintActiveIndex = null;

  const board = $('board');
  const scoreEl = $('score');
  const timeEl = $('time');
  const movesEl = $('moves');
  const accountEl = $('accountScore');

  function refreshStats(){
    if(scoreEl) scoreEl.textContent = score;
    if(timeEl) timeEl.textContent = timeLeft;
    if(movesEl) movesEl.textContent = moves;
    if(accountEl) accountEl.textContent = totalAccountScore;
  }

  // ====== Name ======
  function askName(force=false){
    if(playerName && !force) return;
    const n = prompt('Oyuncu adÄ±nÄ± gir:');
    if(n && n.trim()){
      playerName = n.trim();
      localStorage.setItem('playerName', playerName);
      const nameBadge = $('nameBadge');
      if(nameBadge) nameBadge.textContent = playerName;
    }
  }

  const changeNameBtn = $('changeNameBtn');
  if(changeNameBtn){ changeNameBtn.onclick = ()=>askName(true); }

  // ====== Utils ======
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
  function nearSquareCols(n){ return Math.ceil(Math.sqrt(n)); }
  function setGrid(n){ const cols = nearSquareCols(n); board.style.gridTemplateColumns = `repeat(${cols}, minmax(80px, 1fr))`; }

  // ====== Words ======
  const baseWords = {
    en: [ ['apple','elma'],['book','kitap'],['car','araba'],['dog','kÃ¶pek'],['water','su'],['house','ev'],['sun','gÃ¼neÅŸ'],['moon','ay'],['tree','aÄŸaÃ§'],['road','yol'],['food','yemek'],['friend','arkadaÅŸ'],['music','mÃ¼zik'],['city','ÅŸehir'],['school','okul'],['work','iÅŸ'],['time','zaman'],['money','para'],['game','oyun'],['love','sevgi'],['family','aile'],['world','dÃ¼nya'],['night','gece'],['day','gÃ¼n'] ],
    ko: [ ['ì‚¬ê³¼','elma'],['ì±…','kitap'],['ì°¨','araba'],['ê°œ','kÃ¶pek'],['ë¬¼','su'],['ì§‘','ev'],['í•´','gÃ¼neÅŸ'],['ë‹¬','ay'],['ë‚˜ë¬´','aÄŸaÃ§'],['ê¸¸','yol'],['ìŒì‹','yemek'],['ì¹œêµ¬','arkadaÅŸ'],['ìŒì•…','mÃ¼zik'],['ë„ì‹œ','ÅŸehir'],['í•™êµ','okul'],['ì¼','iÅŸ'],['ì‹œê°„','zaman'],['ëˆ','para'],['ê²Œì„','oyun'],['ì‚¬ë‘','sevgi'],['ê°€ì¡±','aile'],['ì„¸ê³„','dÃ¼nya'],['ë°¤','gece'],['ë‚®','gÃ¼n'] ]
  };

  function getPool(){
    const custom = JSON.parse(localStorage.getItem('customWords')||'{}');
    const arr = (baseWords[currentLang]||[]).concat(custom[currentLang]||[]);
    return arr;
  }

  // ====== Build ======
  function startGame(){
    clearInterval(timer);
    first = null; lock = false; moves = 0; score = 0; streak = 0; mistakeStreak = 0; hintActiveIndex = null;
    timeLeft = 120;
    refreshStats();

    const pool = getPool();
    if(pool.length < pairs){ alert('Yeterli kelime yok. Kelimeleri YÃ¶net kÄ±smÄ±ndan ekleyebilirsin.'); return; }

    const chosen = shuffle(pool.slice()).slice(0, pairs);
    let tiles = [];
    chosen.forEach((w,i)=>{
      tiles.push({ key:i, text:w[0] });
      tiles.push({ key:i, text:w[1] });
    });
    tiles = shuffle(tiles);

    board.innerHTML='';
    setGrid(tiles.length);
    tiles.forEach((t,idx)=>{
      const d = document.createElement('div');
      d.className = 'tile hidden';
      d.dataset.key = t.key;
      d.dataset.index = idx;
      d.textContent = t.text;
      d.onclick = ()=>onPick(d);
      board.appendChild(d);
    });

    timer = setInterval(()=>{
      timeLeft--; refreshStats();
      if(timeLeft<=0){ endGame(); }
    },1000);
  }

  // ====== Scoring Rules ======
  function applyMatch(){
    if(streak>=1){ score += 30; } else { score += 15; }
    streak++; mistakeStreak = 0;
  }
  function applyMistake(){
    if(mistakeStreak>=1){ score -= 10; } else { score -= 5; }
    mistakeStreak++; streak = 0;
  }

  // ====== Hint ======
  function useHint(){
    if(score < 20){ alert('Hint iÃ§in en az 20 puan gerekir.'); return; }
    if(hintActiveIndex !== null){ alert('Zaten bir hint aÃ§Ä±k.'); return; }
    score -= 20; refreshStats();
    const tiles = [...document.querySelectorAll('.tile')].filter(t=>!t.classList.contains('matched'));
    if(tiles.length===0) return;
    const pick = tiles[Math.floor(Math.random()*tiles.length)];
    hintActiveIndex = pick.dataset.index;
    pick.classList.remove('hidden'); pick.classList.add('revealed');
    setTimeout(()=>{
      if(hintActiveIndex !== null){ pick.classList.add('hidden'); pick.classList.remove('revealed'); hintActiveIndex = null; }
    }, 1500);
  }

  // ====== Gameplay ======
  function onPick(el){
    if(lock || el.classList.contains('matched') || el === first) return;
    el.classList.remove('hidden'); el.classList.add('revealed');

    if(first===null){ first = el; return; }

    moves++; refreshStats();
    const second = el;

    if(first.dataset.key === second.dataset.key){
      first.classList.add('matched'); second.classList.add('matched');
      first.classList.remove('revealed'); second.classList.remove('revealed');
      applyMatch();

      if(hintActiveIndex !== null && (first.dataset.index===hintActiveIndex || second.dataset.index===hintActiveIndex)){
        score += 10; hintActiveIndex = null;
      }

      refreshStats();
      first = null;
      checkWin();
    } else {
      applyMistake(); refreshStats();
      lock = true;
      setTimeout(()=>{
        first.classList.add('hidden'); second.classList.add('hidden');
        first.classList.remove('revealed'); second.classList.remove('revealed');
        first = null; lock = false;
      }, 700);
    }
  }

  function checkWin(){
    const left = document.querySelectorAll('.tile:not(.matched)').length;
    if(left===0){ endGame(true); }
  }

  function endGame(win=false){
    clearInterval(timer);
    totalAccountScore += Math.max(0, score);
    localStorage.setItem('accountScore', String(totalAccountScore));
    refreshStats();
    saveScore(win);
    alert(win ? 'Tebrikler! Oyun bitti.' : 'SÃ¼re doldu!');
  }

  // ====== Leaderboard ======
  function saveScore(win){
    const list = JSON.parse(localStorage.getItem('scores')||'[]');
    list.push({ name: playerName||'Oyuncu', lang: currentLang, pairs, time: timeLeft, moves, score });
    list.sort((a,b)=> (b.score-a.score) || (b.time-a.time) || (a.moves-b.moves));
    localStorage.setItem('scores', JSON.stringify(list));
    renderBoard();
  }

  function renderBoard(){
    const list = JSON.parse(localStorage.getItem('scores')||'[]');
    const tbody = document.getElementById('bestBody');
    if(!tbody) return;
    tbody.innerHTML='';
    list.slice(0,20).forEach((r,i)=>{
      const tr = document.createElement('tr');
      tr.className = 'best-row' + (i===0?' first':'');
      tr.innerHTML = `<td>${i+1}</td><td>${r.name}</td><td>${r.lang}</td><td>${r.pairs}</td><td>${r.time}</td><td>${r.score}</td>`;
      tbody.appendChild(tr);
    });
  }

  // ====== UI Hooks ======
  const startBtn = $('startBtn');
  if(startBtn){ startBtn.onclick = ()=>{
      currentLang = $('langSel').value;
      pairs = Number($('pairsSel').value);
      startGame();
    }; }

  const hintBtn = $('hintBtn');
  if(hintBtn){ hintBtn.onclick = useHint; }

  // ====== Init ======
  askName();
  const nameBadge = $('nameBadge');
  if(nameBadge) nameBadge.textContent = playerName || 'Oyuncu';
  renderBoard();
  refreshStats();
</script>
</body>
</html>
