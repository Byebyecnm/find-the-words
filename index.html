<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kelimeli Mahjong - Zamanlƒ±, Puanlƒ±, ƒ∞sim & Kelime Y√∂neticili</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:12px; }
    h1 { margin:0 0 12px; }
    .layout { max-width: 1200px; margin: 0 auto; display:grid; grid-template-columns: 320px 1fr; gap:12px; }
    @media (max-width: 900px){ .layout{ grid-template-columns: 1fr; } }.panel { background:#020617; border:1px solid #1f2933; border-radius:16px; padding:10px; }
.panel h3{ margin:4px 0 8px; }
.best-table{ width:100%; border-collapse:separate; border-spacing:0 6px; font-size:12px; }
.best-table th{ text-align:left; color:#94a3b8; font-weight:600; padding:0 6px 4px; }
.best-row{ background:#0b1220; border:1px solid #1f2933; border-radius:12px; }
.best-row td{ padding:6px 8px; }
.best-row.first{ outline:2px solid #22c55e; box-shadow:0 0 0 2px rgba(34,197,94,.2) inset; }

.toolbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
select, button, input { background:#111827; color:#e5e7eb; border:1px solid #334155; border-radius:10px; padding:10px 12px; font-size:14px; }
button { cursor:pointer; }
button.primary { background:#2563eb; border-color:#2563eb; }
button.warn { background:#7c2d12; border-color:#7c2d12; }
button.ghost { background:#020617; }
button:disabled { opacity:0.6; cursor:not-allowed; }
.stats { display:flex; gap:12px; flex-wrap:wrap; }

/* Mobilde √ºstte sabit kontrol barƒ± */
.topbar{ position:sticky; top:0; z-index:20; background:#020617; border:1px solid #1f2933; border-radius:16px; padding:8px; margin-bottom:10px; }

.board { display:grid; gap:8px; }
.tile { background:#020617; border:1px solid #1f2933; border-radius:14px; padding:12px; min-height:64px; display:flex; align-items:center; justify-content:center; text-align:center; font-weight:700; font-size:18px; user-select:none; transition: transform .1s ease, background .2s ease, border .2s ease; }
.tile:hover { transform: translateY(-1px); }
.tile.hidden { background:#020617; color:transparent; }
.tile.revealed { background:#0b1220; border-color:#3b82f6; }
.tile.matched { background:#052e16; border-color:#22c55e; color:#86efac; }
.footer { margin-top:12px; color:#94a3b8; }
.success { color:#22c55e; }
.danger { color:#f87171; }
.grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }

.namebar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
.badge{ background:#0b1220; border:1px solid #1f2933; border-radius:999px; padding:6px 10px; font-size:12px; }

/* Modal */
.modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,.7); display:none; align-items:center; justify-content:center; z-index:50; }
.modal{ background:#020617; border:1px solid #1f2933; border-radius:16px; padding:16px; width:min(520px, 92vw); }
.modal h3{ margin:0 0 8px; }
.modal .row{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
.modal .row > *{ flex:1; }
.modal .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }

/* Kelime listesi */
.word-list{ max-height:220px; overflow:auto; border:1px solid #1f2933; border-radius:12px; padding:8px; }
.word-item{ display:flex; gap:8px; align-items:center; justify-content:space-between; background:#0b1220; border:1px solid #1f2933; border-radius:10px; padding:6px 8px; margin-bottom:6px; font-size:13px; }
.word-item small{ color:#94a3b8; }

@media (max-width: 600px){
  h1{ font-size:20px; }
  .tile{ font-size:16px; min-height:56px; }
  .grid{ grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
}

  </style>
</head>
<body>
  <div class="layout">
    <!-- Sol: En ƒ∞yiler -->
    <aside class="panel">
      <h3>üèÜ En ƒ∞yiler</h3>
      <p style="color:#94a3b8; font-size:13px; margin:0 0 8px;">ƒ∞sim ‚Ä¢ Dil ‚Ä¢ Seviye ‚Ä¢ S√ºre ‚Ä¢ Puan</p>
      <table class="best-table">
        <thead>
          <tr>
            <th>#</th><th>ƒ∞sim</th><th>Dil</th><th>Seviye</th><th>S√ºre</th><th>Puan</th>
          </tr>
        </thead>
        <tbody id="bestBody"></tbody>
      </table>
    </aside><!-- Saƒü: Oyun -->
<main class="app">
  <div class="topbar">
    <h1>üÄÑ Kelimeli Mahjong ‚Äî Zamanlƒ± & Puanlƒ±</h1>
    <div class="namebar">
      <span class="badge">Oyuncu:</span>
      <strong id="playerNameLabel">‚Äî</strong>
      <button id="changeNameBtn" class="ghost">ƒ∞smi Deƒüi≈ütir</button>
      <button id="manageWordsBtn" class="ghost">Kelimeleri Y√∂net</button>
    </div>
    <p>Seviyeler: <b>8</b> / <b>12</b> / <b>16</b> / <b>20</b> / <b>24</b> √ßift. Her oyun kelimeler <b>havuzdan rastgele</b> se√ßilir. Doƒüru = +100, Yanlƒ±≈ü = -25.</p>

    <div class="toolbar">
      <label>
        Dil:
        <select id="langSelect">
          <option value="en">ƒ∞ngilizce</option>
          <option value="kr">Korece</option>
        </select>
      </label>
      <label>
        Seviye:
        <select id="levelSelect">
          <option value="0">8 √áift</option>
          <option value="1">12 √áift</option>
          <option value="2">16 √áift</option>
          <option value="3">20 √áift</option>
          <option value="4">24 √áift</option>
        </select>
      </label>
      <label>
        S√ºre:
        <select id="timeSelect">
          <option value="120">120 sn</option>
          <option value="180">180 sn</option>
          <option value="300">300 sn</option>
        </select>
      </label>
      <button class="primary" id="startBtn">Ba≈ülat</button>
      <button class="warn" id="resetBtn">Yeniden Ba≈ülat</button>
      <div class="stats">
        <div>‚è±Ô∏è <strong id="timeLeft">0</strong>s</div>
        <div>‚≠ê <strong id="score">0</strong></div>
        <div>üéØ <strong id="matches">0</strong></div>
        <div>üë£ <strong id="moves">0</strong></div>
      </div>
    </div>
  </div>

  <div id="board" class="board grid"></div>
  <div class="footer" id="status"></div>
</main>

  </div>  <!-- ƒ∞sim Modal -->  <div id="nameModal" class="modal-backdrop">
    <div class="modal">
      <h3>Oyuncu Adƒ±</h3>
      <p style="color:#94a3b8; font-size:13px;">Skor tablosunda g√∂r√ºnecek ismini yaz.</p>
      <div class="row">
        <input id="nameInput" placeholder="ƒ∞smin..." />
      </div>
      <div class="actions">
        <button id="nameCancel" class="ghost">Vazge√ß</button>
        <button id="nameSave" class="primary">Kaydet</button>
      </div>
    </div>
  </div>  <!-- Kelime Y√∂netimi Modal -->  <div id="wordsModal" class="modal-backdrop">
    <div class="modal">
      <h3>Kelime Havuzu</h3>
      <p style="color:#94a3b8; font-size:13px;">Kendi kelimelerini ekle/sil. Oyun bu havuzdan rastgele se√ßecek.</p>
      <div class="row">
        <select id="wordLangSelect">
          <option value="en">ƒ∞ngilizce</option>
          <option value="kr">Korece</option>
        </select>
      </div>
      <div class="row">
        <input id="wordA" placeholder="Yabancƒ± kelime (√∂rn: apple / ÏÇ¨Í≥º)" />
        <input id="wordB" placeholder="T√ºrk√ße kar≈üƒ±lƒ±ƒüƒ± (√∂rn: elma)" />
      </div>
      <div class="row">
        <button id="addWordBtn" class="primary">Ekle</button>
        <button id="clearCustomBtn" class="warn">√ñzel Kelimeleri Temizle</button>
      </div>
      <div class="word-list" id="wordList"></div>
      <div class="actions">
        <button id="wordsClose" class="ghost">Kapat</button>
      </div>
    </div>
  </div>  <script>
    // ===== Varsayƒ±lan Kelime Havuzlarƒ± =====
    const defaultPool = {
      en: [ ['apple','elma'], ['book','kitap'], ['water','su'], ['sun','g√ºne≈ü'], ['dog','k√∂pek'], ['house','ev'], ['travel','seyahat'], ['friend','arkada≈ü'], ['music','m√ºzik'], ['money','para'], ['city','≈üehir'], ['food','yemek'], ['work','i≈ü'], ['school','okul'], ['decision','karar'], ['improve','geli≈ütirmek'], ['environment','√ßevre'], ['knowledge','bilgi'], ['opportunity','fƒ±rsat'], ['challenge','zorluk'], ['culture','k√ºlt√ºr'], ['language','dil'], ['future','gelecek'], ['success','ba≈üarƒ±'], ['time','zaman'], ['day','g√ºn'], ['night','gece'], ['family','aile'], ['love','sevgi'], ['game','oyun'], ['learn','√∂ƒürenmek'], ['write','yazmak'], ['read','okumak'] ],
      kr: [ ['ÏÇ¨Í≥º','elma'], ['Ï±Ö','kitap'], ['Î¨º','su'], ['Ìï¥','g√ºne≈ü'], ['Í∞ú','k√∂pek'], ['Ïßë','ev'], ['Ïó¨Ìñâ','seyahat'], ['ÏπúÍµ¨','arkada≈ü'], ['ÏùåÏïÖ','m√ºzik'], ['Îèà','para'], ['ÎèÑÏãú','≈üehir'], ['ÏùåÏãù','yemek'], ['Ïùº','i≈ü'], ['ÌïôÍµê','okul'], ['Í≤∞Ï†ï','karar'], ['Í∞úÏÑ†ÌïòÎã§','geli≈ütirmek'], ['ÌôòÍ≤Ω','√ßevre'], ['ÏßÄÏãù','bilgi'], ['Í∏∞Ìöå','fƒ±rsat'], ['ÎèÑÏ†Ñ','zorluk'], ['Î¨∏Ìôî','k√ºlt√ºr'], ['Ïñ∏Ïñ¥','dil'], ['ÎØ∏Îûò','gelecek'], ['ÏÑ±Í≥µ','ba≈üarƒ±'], ['ÏãúÍ∞Ñ','zaman'], ['ÎÇÆ','g√ºn'], ['Î∞§','gece'], ['Í∞ÄÏ°±','aile'], ['ÏÇ¨Îûë','sevgi'], ['Í≤åÏûÑ','oyun'], ['Î∞∞Ïö∞Îã§','√∂ƒürenmek'], ['Ïì∞Îã§','yazmak'], ['ÏùΩÎã§','okumak'] ]
    };
    const levelPairs = [8, 12, 16, 20, 24];

    // ===== LocalStorage Keys =====
    const NAME_KEY = 'mahjong_player_name_v2';
    const BEST_KEY = 'mahjong_best_v4';
    const CUSTOM_KEY = 'mahjong_custom_words_v1';

    // ===== DOM =====
    const langSelect = document.getElementById('langSelect');
    const levelSelect = document.getElementById('levelSelect');
    const timeSelect = document.getElementById('timeSelect');
    const boardEl = document.getElementById('board');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const movesEl = document.getElementById('moves');
    const matchesEl = document.getElementById('matches');
    const scoreEl = document.getElementById('score');
    const timeLeftEl = document.getElementById('timeLeft');
    const statusEl = document.getElementById('status');
    const bestBody = document.getElementById('bestBody');
    const playerNameLabel = document.getElementById('playerNameLabel');
    const changeNameBtn = document.getElementById('changeNameBtn');
    const manageWordsBtn = document.getElementById('manageWordsBtn');

    // Modals
    const nameModal = document.getElementById('nameModal');
    const nameInput = document.getElementById('nameInput');
    const nameSave = document.getElementById('nameSave');
    const nameCancel = document.getElementById('nameCancel');

    const wordsModal = document.getElementById('wordsModal');
    const wordLangSelect = document.getElementById('wordLangSelect');
    const wordA = document.getElementById('wordA');
    const wordB = document.getElementById('wordB');
    const addWordBtn = document.getElementById('addWordBtn');
    const clearCustomBtn = document.getElementById('clearCustomBtn');
    const wordList = document.getElementById('wordList');
    const wordsClose = document.getElementById('wordsClose');

    // ===== Oyun Durumu =====
    let first = null, second = null, lock = false;
    let moves = 0, matches = 0, totalPairs = 0, score = 0;
    let timer = null, timeLeft = 0, gameActive = false;

    // ===== Yardƒ±mcƒ±lar =====
    function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }

    function getCustom(){ try{ return JSON.parse(localStorage.getItem(CUSTOM_KEY) || '{"en":[],"kr":[]}'); } catch{ return {en:[], kr:[]}; } }
    function setCustom(obj){ localStorage.setItem(CUSTOM_KEY, JSON.stringify(obj)); }

    function getPool(lang){ const custom = getCustom(); return defaultPool[lang].concat(custom[lang] || []); }

    function samplePairs(lang, needed) {
      const base = getPool(lang).slice();
      shuffle(base);
      const picked = base.slice(0, needed);
      return picked;
    }

    // ===== ƒ∞sim =====
    function openNameModal(){ const current = localStorage.getItem(NAME_KEY) || ''; nameInput.value = current; nameModal.style.display='flex'; nameInput.focus(); }
    function closeNameModal(){ nameModal.style.display='none'; }
    function saveName(){ const name = (nameInput.value || '').trim() || 'Misafir'; localStorage.setItem(NAME_KEY, name); playerNameLabel.textContent = name; closeNameModal(); }
    changeNameBtn.addEventListener('click', openNameModal);
    nameSave.addEventListener('click', saveName);
    nameCancel.addEventListener('click', closeNameModal);

    function ensureName(){ let name = localStorage.getItem(NAME_KEY); if(!name){ openNameModal(); } else { playerNameLabel.textContent = name; } }

    // ===== Kelime Y√∂netimi =====
    function openWordsModal(){ wordsModal.style.display='flex'; renderWordList(); }
    function closeWordsModal(){ wordsModal.style.display='none'; }
    manageWordsBtn.addEventListener('click', openWordsModal);
    wordsClose.addEventListener('click', closeWordsModal);

    function renderWordList(){ const lang = wordLangSelect.value; const custom = getCustom(); const list = custom[lang] || []; wordList.innerHTML=''; if(list.length===0){ wordList.innerHTML = '<div style="color:#94a3b8; font-size:13px;">Hen√ºz √∂zel kelime yok.</div>'; return; }
      list.forEach((p, i)=>{ const div=document.createElement('div'); div.className='word-item'; div.innerHTML = `<div><strong>${p[0]}</strong> <small>‚Üí</small> ${p[1]}</div><button data-i="${i}" class="warn">Sil</button>`; div.querySelector('button').addEventListener('click', ()=>{ const c=getCustom(); c[lang].splice(i,1); setCustom(c); renderWordList(); }); wordList.appendChild(div); }); }

    wordLangSelect.addEventListener('change', renderWordList);

    addWordBtn.addEventListener('click', ()=>{ const a = wordA.value.trim(); const b = wordB.value.trim(); if(!a || !b) return; const lang = wordLangSelect.value; const c = getCustom(); c[lang] = c[lang] || []; c[lang].push([a,b]); setCustom(c); wordA.value=''; wordB.value=''; renderWordList(); });

    clearCustomBtn.addEventListener('click', ()=>{ if(!confirm('√ñzel kelimeler silinsin mi?')) return; setCustom({en:[], kr:[]}); renderWordList(); });

    // ===== Zaman =====
    function startTimer(){ clearInterval(timer); timer = setInterval(()=>{ if(!gameActive) return; timeLeft--; timeLeftEl.textContent = timeLeft; if(timeLeft<=0){ endGame(false); } }, 1000); }

    // ===== Oyun Kurulumu =====
    function setupBoard(){ const lang = langSelect.value; const lvl = Number(levelSelect.value); const neededPairs = levelPairs[lvl]; const poolNow = getPool(lang); if(poolNow.length < neededPairs){ alert('Kelime havuzunda yeterli kelime yok! L√ºtfen kelime ekleyin.'); return; }
      const pairs = samplePairs(lang, neededPairs);
      const tiles = []; pairs.forEach(([a,b], idx)=>{ tiles.push({id:idx, text:a}); tiles.push({id:idx, text:b}); });
      totalPairs = pairs.length; moves=0; matches=0; score=0; movesEl.textContent=moves; matchesEl.textContent=matches; scoreEl.textContent=score; statusEl.textContent='';
      boardEl.innerHTML=''; first=null; second=null; lock=false;
      const shuffled = shuffle(tiles); boardEl.className='board grid';
      shuffled.forEach(tile=>{ const div=document.createElement('div'); div.className='tile hidden'; div.dataset.id=tile.id; div.dataset.text=tile.text; div.textContent=tile.text; div.addEventListener('click', ()=>onTileClick(div)); boardEl.appendChild(div); }); }

    function startGame(){ setupBoard(); timeLeft = Number(timeSelect.value); timeLeftEl.textContent = timeLeft; gameActive=true; lock=false; startTimer(); }

    function onTileClick(tile){ if(!gameActive || lock) return; if(tile.classList.contains('matched') || tile===first) return; tile.classList.remove('hidden'); tile.classList.add('revealed'); if(!first){ first=tile; return; }
      second=tile; lock=true; moves++; movesEl.textContent=moves; const isMatch = first.dataset.id===second.dataset.id && first.dataset.text!==second.dataset.text;
      if(isMatch){ setTimeout(()=>{ first.classList.remove('revealed'); second.classList.remove('revealed'); first.classList.add('matched'); second.classList.add('matched'); matches++; matchesEl.textContent=matches; score+=100; scoreEl.textContent=score; resetPick(); if(matches===totalPairs){ endGame(true); } }, 200); }
      else{ setTimeout(()=>{ first.classList.add('hidden'); second.classList.add('hidden'); first.classList.remove('revealed'); second.classList.remove('revealed'); score=Math.max(0, score-25); scoreEl.textContent=score; resetPick(); }, 450); }
    }
    function resetPick(){ first=null; second=null; lock=false; }

    // ===== En ƒ∞yiler (Adil Sƒ±ralama) =====
    // Kural: 1) Puan (y√ºksek daha iyi)
    //        2) Kalan s√ºre (y√ºksek daha iyi)
    //        3) Hamle (d√º≈ü√ºk daha iyi)
    function loadBest(){ try{ return JSON.parse(localStorage.getItem(BEST_KEY) || '[]'); } catch{ return []; } }
    function saveBest(entry){ const list = loadBest(); list.push(entry);
      list.sort((a,b)=>{
        if(b.score !== a.score) return b.score - a.score;               // 1) Puan
        if(b.timeLeft !== a.timeLeft) return b.timeLeft - a.timeLeft;   // 2) Kalan s√ºre
        if(a.moves !== b.moves) return a.moves - b.moves;               // 3) Hamle
        return 0;
      });
      const trimmed = list.slice(0, 10);
      localStorage.setItem(BEST_KEY, JSON.stringify(trimmed));
    }
    function renderBest(){ const list = loadBest(); bestBody.innerHTML=''; if(list.length===0){ const tr=document.createElement('tr'); tr.className='best-row'; tr.innerHTML='<td colspan="6">Hen√ºz kayƒ±t yok</td>'; bestBody.appendChild(tr); return; }
      list.forEach((e,i)=>{ const tr=document.createElement('tr'); tr.className='best-row' + (i===0?' first':''); const lvlText = levelPairs[e.lvl] + '√á'; const langText = e.lang==='kr'?'KR':'EN'; tr.innerHTML = `<td>${i+1}</td><td>${e.name}</td><td>${langText}</td><td>${lvlText}</td><td>${e.used}s</td><td><strong>${e.score}</strong></td>`; bestBody.appendChild(tr); }); }

    function endGame(won){ gameActive=false; clearInterval(timer); lock=true; const name = localStorage.getItem(NAME_KEY) || 'Misafir'; const lang=langSelect.value; const lvl=Number(levelSelect.value); const totalTime=Number(timeSelect.value); const used = totalTime - Math.max(0, timeLeft);
      statusEl.innerHTML = won ? `<span class="success">Kazandƒ±n! Skor: ${score}</span>` : `<span class="danger">S√ºre Doldu ‚è∞ Skor: ${score}</span>`;
      saveBest({ date:new Date().toISOString(), name, lang, lvl, used, timeLeft, moves, score }); renderBest(); }

    startBtn.addEventListener('click', startGame); resetBtn.addEventListener('click', startGame);

    // ƒ∞lk a√ßƒ±lƒ±≈ü
    ensureName(); renderBest(); timeLeftEl.textContent = timeSelect.value;
  </script></body>
</html>